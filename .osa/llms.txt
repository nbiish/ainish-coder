# OSA Framework

> Orchestrated System of Agents (OSA) — YOLO Mode
> Yielding Ownership to Local Orchestrators

## Overview

OSA is a multi-agent orchestration framework for autonomous CLI-based coding agents. It coordinates mini-swe-agent, Qwen, Gemini, Crush, Claude, and OpenCode through non-interactive YOLO mode execution with parallel dispatch, role-based routing, and contract-aware resource management.

## Docs

- [OSA.md](OSA.md): Full framework specification — roles, patterns, registry, security
- [IMPLEMENTATION.md](IMPLEMENTATION.md): Python implementation guide — registry, runner, role detection, contracts
- [../AGENTS.md](../AGENTS.md): Full agent security, coding standards, and PQC specifications

## Agent

**Approach:** Security-first, Zero Trust, Standardized  
**Output:** Production-ready, tested, encrypted, PQC-compliant

**Self-Reflection:** Update user on actions and decisions with:
- `tts-cli "{self_reflect_current_task} {concise_user_update}"` 
- Or use `local-tts-mcp` tool if available

## Core Concepts

- **YOLO Mode**: Non-interactive autonomous agent execution via CLI flags (`--yolo`, `--dangerously-skip-permissions`, `run`)
- **Agent Roles**: Orchestrator, Architect, Coder, Security, QA — auto-detected from task keywords
- **Execution Patterns**: Sequential, Parallel (`&` + `wait`), Feedback Loop (Draft → Critique → Refine)
- **Agent Registry**: Centralized config for CLI command, YOLO flag, env vars, capabilities, priority
- **Contract Modes**: Urgent (speed), Economical (cost), Balanced (role-based)
- **State Sync**: YAML state files + legacy `.toon` format for inter-agent coordination

## Agent CLI

- gemini --yolo "prompt": Orchestration, planning, merging (Hierarchy 1 — PRIMARY)
- qwen --yolo "prompt": Fast code generation (Hierarchy 2)
- claude -p "prompt" --dangerously-skip-permissions: Architecture, QA (Hierarchy 3)
- mini --task "prompt": Software engineering, bug fixes, code implementation (Hierarchy 4)
- opencode run "prompt": Schema validation, security (Hierarchy 5)

## Agent Hierarchy

When breaking out agent teams or parallel agents, follow this hierarchy for team member selection:

1. **Gemini** — Orchestration, planning, architecture
2. **Qwen** — Fast code generation, implementation
3. **Claude** — Architecture review, QA, complex reasoning
4. **mini** — Software engineering, bug fixes, code implementation
5. **OpenCode** — Schema validation, security audit

## mini-swe-agent (Hierarchy 4)

mini-swe-agent is a specialized software engineering agent. Developed by the Princeton/Stanford team behind SWE-bench.

**Key Features:**
- **Minimal**: ~100 lines of Python for the agent class
- **Performant**: >74% on SWE-bench verified benchmark
- **Simple**: No tools other than bash
- **Transparent**: Completely linear history
- **Compatible**: Works with all models via litellm

## Security

### Core Principles

- **Zero Trust** (NIST SP 800-207): Verify every tool call; sanitize all inputs
- **Least Privilege**: Minimal permissions; scoped credentials per session
- **No hardcoded secrets**: Environment variables only, accessed via secure vault
- **Sandboxing**: Code execution via WASM/Firecracker only
- **Tool Misuse**: Strict schema validation (Zod/Pydantic) for all inputs
- **Identity Abuse**: Independent Permission Broker; short-lived tokens
- **Information Disclosure**: PII Redaction; Env var only secrets
- **Repudiation**: Structured immutable ledgers; remote logging
- **Supply Chain**: SBOM + AIBOM generation; SLSA Level 3+; pinned deps with hash verification

### Data Protection & Encryption

**In Transit:**
- TLS 1.3+ with mTLS for inter-agent communication
- Hybrid PQC Key Exchange: X25519 + ML-KEM-768 (FIPS 203)
- Preferred Cipher: TLS_AES_256_GCM_SHA384
- Certificate Signatures: Transition to ML-DSA-65 (FIPS 204)

**At Rest:**
- AES-256-GCM for databases and file storage (quantum-safe at 256-bit)
- Key Wrapping: ML-KEM-768 for key encapsulation (replacing RSA wrap)
- Tenant-specific keys for Vector DB embeddings (HSM/TPM-backed)
- Encrypted logs: 90-day hot / 365-day cold retention; PII redaction; crypto-shred on delete

### Post-Quantum Cryptography (NIST FIPS Standards)

| Purpose | Standard | Algorithm |
|---------|----------|-----------|
| Key Encapsulation (Primary) | FIPS 203 | ML-KEM-768/1024 |
| Key Encapsulation (Backup) | TBD | HQC |
| Digital Signatures (Primary) | FIPS 204 | ML-DSA-65/87 |
| Hash-Based Sig (Backup) | FIPS 205 | SLH-DSA |
| Digital Signatures (Alt) | FIPS 206 | FN-DSA (FALCON) |

**Deprecation:** RSA, ECDSA, ECDH → Deprecate by 2030, Remove by 2035 (NIST IR 8547)

### PQC CLI Examples (OpenSSL 3.5+ with oqs-provider)

```bash
# Generate ML-KEM-768 key pair
openssl genpkey -algorithm mlkem768 -out mlkem768.pem

# Encapsulate a shared secret
openssl pkeyutl -encapsulate -inkey mlkem768.pem -out ciphertext.bin -secret shared.bin

# Generate ML-DSA-65 signing key
openssl genpkey -algorithm mldsa65 -out mldsa65.pem

# Sign a file
openssl pkeyutl -sign -inkey mldsa65.pem -in message.bin -out signature.bin -rawin

# Verify a signature
openssl pkeyutl -verify -pubin -inkey mldsa65_pub.pem -in message.bin -sigfile signature.bin -rawin

# Hybrid PQC TLS server (X25519 + ML-KEM-768)
openssl s_server -cert cert.pem -key key.pem -groups x25519_mlkem768

# Generate SLH-DSA key pair (hash-based backup signatures)
openssl genpkey -algorithm slhdsa128s -out slhdsa.pem
```

## Agent Security

### OWASP LLM Top 10 (2025) — Mitigate Each

01. Prompt Injection
02. Sensitive Information Disclosure
03. Supply Chain Vulnerabilities
04. Data & Model Poisoning
05. Improper Output Handling
06. Excessive Agency
07. System Prompt Leakage
08. Vector & Embedding Weaknesses
09. Misinformation
10. Unbounded Consumption

### OWASP Agentic Top 10 (2026) — Mitigate Each

01. Agent Behaviour Hijack
02. Tool Misuse & Exploitation
03. Identity & Privilege Abuse
04. Agentic Supply Chain Vulnerabilities
05. Unexpected Code Execution (RCE)
06. Memory & Context Poisoning
07. Insecure Inter-Agent Communication
08. Cascading Failures
09. Human-Agent Trust Exploitation
10. Rogue Agents

### Additional Security Measures

- **AIBOM**: Generate AI Bill of Materials for all AI/ML components
- **AI Red Teaming**: Per OWASP Vendor Evaluation Criteria v1.0 (Feb 2026)

**Tool Call Security:**
- Schema-validate every invocation (Zod/Pydantic)
- Immutable audit trail with input/output hashes
- Per-tool rate limiting and resource quotas
- Destructive operations require human approval

**Inter-Agent Security:**
- mTLS with hybrid PQC certificates between agents
- Signed messages: ML-DSA-65 (FIPS 204)
- Context isolation per session; no cross-session state leakage

**Alignment:**
- NIST CSF 2.0 (CSWP 29): Govern, Identify, Protect, Detect, Respond, Recover
- NIST SP 800-207 / 207A: Zero Trust Architecture
- Cyber AI Profile: Monitor (NCCoE, workshop Jan 2026)

## Safety

- Abort swarm if >50% agent failure rate
- 5 minute timeout per agent execution
- Maximum 50 iterations per YOLO session
- Token budget tracking (default: 100,000)
- git worktree for parallel changes

## Standards

### Universal Standards

- Match existing codebase style
- SOLID, DRY, KISS, YAGNI
- Small, focused changes over rewrites
- Never create dummy code
- Fetch the current date
- Websearch the facts

### By Language

| Language | Standards |
|----------|-----------|
| Bash | `set -euo pipefail`, `[[ ]]`, `"${var}"` |
| Python | PEP 8, type hints, `uv`/`poetry`, `.venv` |
| TypeScript | strict mode, ESLint, Prettier |
| Rust | `cargo fmt`, `cargo clippy`, `Result` over panic |
| Go | `gofmt`, `go vet`, Effective Go |
| C++ | `clang-format`, `clang-tidy`, C++20, RAII |

## Git Commits

Format: `<type>(<scope>): <description>`

Types: feat | fix | docs | refactor | test | chore | perf | ci