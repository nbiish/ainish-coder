# GitHub Actions - Automation-First Security Suite
<!-- markdownlint-disable MD004 MD009 MD030 MD031 MD032 MD046 -->

This directory contains the **Automation-First** security workflows.
**Philosophy:** We do not rely on manual local scripts. We rely on cloud-native, automated enforcement that fails gracefully or blocks strictly depending on the risk.

## ğŸ›¡ï¸ Workflow Architecture

We use a **"Safe Rewrite vs. Strict Blocker"** model to minimize noise and maximize security.

### 1. `safe-sanitize.yml` - **Safe Rewrite (No-Fail)** ğŸ§¹
*formerly `auto-sanitize.yml`*

**Behavior:**
- **Run Trigger:** Push, PR, or any file change.
- **Action:** Scans ALL text files (Code, Config, Env, etc.) for API keys/Secrets.
- **Outcome:**
  - ğŸŸ¢ **No Secrets:** Silent pass (No-op).
  - ğŸŸ¢ **Secrets Found:** Automatically rewrites the file (redacts secrets) and commits it back (`[skip ci]`).
  - ğŸ”´ **Failure:** Only if the infrastructure fails (e.g., git permissions).
- **Why:** This is your "Janitor". It cleans up messes without yelling at you.

### 2. `strict-block.yml` - **Secret Detection (Report Only)** ğŸš¨
*formerly `detect-secrets.yml`*

**Behavior:**
- **Run Trigger:** Push & PR.
- **Action:** Runs aggressive scanning engines (TruffleHog, Gitleaks) and custom grep patterns via `reusable-secret-scan.yml`.
- **Outcome:**
  - ğŸŸ¢ **Always Green:** The job never fails the workflow; it only logs findings.
  - ğŸ” **Secrets Found:** Logged as warnings in the job output.
- **Why:** This is your "Security Radar". It surfaces risks without blocking your workflow or spamming failure emails.

### 3. `semgrep.yml` - **Fast Static Analysis (Report-Only)** âš¡
**Behavior:**
- Runs fast static analysis using the `p/security-audit` and `p/secrets` rulesets.
- Writes findings to `semgrep-results.json` and prints them in logs.
- Does **not** fail the workflow.

### 4. `codeql.yml` - **Deep Code Analysis** ğŸ”
**Behavior:** Standard GitHub Advanced Security static analysis for logic bugs and vulnerabilities. CodeQL runs under GitHub's own tooling; it may flag findings in the Security tab, but normal operation is to keep runs green unless there is a tool error.

---

## ğŸš€ Minimal Setup Guide

You do not need to install local hooks. You just need to configure the repo once.

### 1. Enable Permissions (One-Time)
Go to **Settings** â†’ **Actions** â†’ **General**:
- [x] **Workflow permissions**: "Read and write permissions"
- [x] **Allow GitHub Actions to create and approve pull requests**

### 2. Branch Protection (Optional)
You may still choose to protect `main` with status checks, but by default these security workflows are **advisory/report-only** and are not meant to block merges.

---

## ğŸ”„ Daily Workflow (The "Happy Path")

1.  **Write Code**: Work normally. Use `.env` for local secrets.
2.  **Commit & Push**:
    - If you accidentally leave a key in `config.json`:
        - `safe-sanitize.yml` will catch it, scrub it, and push a fix commit.
        - You pull the changes (`git pull`) and keep working.
    - If you commit a deep persistent secret:
        - `strict-block.yml` will log findings as warnings, but the run stays green.
3.  **Review Security Results**:
    - Use the Actions logs and the Security tab (CodeQL) to see findings.
    - Optionally use GitHub Copilot in the editor to help write fixes, but nothing is auto-generated by custom AI.

---

## ğŸ“µ Notes

- Local helper scripts are intentionally not required; all security is run in GitHub Actions.
- Workflows are designed to be **non-blocking** by default; they surface issues without spamming failure emails.
